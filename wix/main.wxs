<?xml version='1.0' encoding='windows-1252'?>
<?if $(sys.BUILDARCH) = x64 or $(sys.BUILDARCH) = arm64 ?>
    <?define PlatformProgramFilesFolder = "ProgramFiles64Folder" ?>
<?else ?>
    <?define PlatformProgramFilesFolder = "ProgramFilesFolder" ?>
<?endif ?>

<Wix xmlns='http://schemas.microsoft.com/wix/2006/wi'>
    <Product
        Id='*'
        Name='projecto_computacional'
        UpgradeCode='82FEE9AE-1DE7-41F3-AECD-A159E60A5F0A'
        Manufacturer='Enzo OBesso enzocipher@gmail.com'
        Language='1033'
        Codepage='1252'
        Version='$(var.Version)'>

        <Package Id='*'
                 Keywords='Installer'
                 Description='Projecto en Rust para la Universidad Peruana de Ciencias Aplicadas'
                 Manufacturer='Enzo OBesso enzocipher@gmail.com'
                 InstallerVersion='450'
                 Languages='1033'
                 Compressed='yes'
                 InstallScope='perMachine'
                 SummaryCodepage='1252'/>

        <MajorUpgrade
            Schedule='afterInstallInitialize'
            DowngradeErrorMessage='A newer version of [ProductName] is already installed. Setup will now exit.'/>

        <Media Id='1' Cabinet='media1.cab' EmbedCab='yes' DiskPrompt='CD-ROM #1'/>
        <Property Id='DiskPrompt' Value='projecto_computacional Installation'/>

        <Directory Id='TARGETDIR' Name='SourceDir'>
            <Directory Id='$(var.PlatformProgramFilesFolder)' Name='PFiles'>
                <Directory Id='APPLICATIONFOLDER' Name='projecto_computacional'>
                    <Directory Id="INSTALLFOLDER" Name="Minimum_Path_Finder"/>

                    <Component Id='License' Guid='*'>
                        <File Id='LicenseFile'
                              DiskId='1'
                              Source='wix\License.rtf'
                              KeyPath='yes'/>
                    </Component>

                    <Directory Id='Bin' Name='bin'>
                        <Component Id='Path' Guid='CF504550-D72E-4DBA-A804-7EBB273D3B6D' KeyPath='yes'>
                            <Environment
                                Id='PATH'
                                Name='PATH'
                                Value='[Bin]'
                                Permanent='no'
                                Part='last'
                                Action='set'
                                System='yes'/>
                        </Component>

                        <Component Id='binary0' Guid='*'>
                            <File
                                Id='exe0'
                                Name='projecto_computacional.exe'
                                DiskId='1'
                                Source='$(var.CargoTargetBinDir)\projecto_computacional.exe'
                                KeyPath='yes'/>
                        </Component>
                    </Directory>
                </Directory>
            </Directory>
            <Directory Id="DesktopFolder" Name="Desktop"/>
        </Directory>

        <Feature Id='Binaries'
                 Title='Application'
                 Description='Installs all binaries and the license.'
                 Level='1'
                 ConfigurableDirectory='APPLICATIONFOLDER'
                 AllowAdvertise='no'
                 Display='expand'
                 Absent='disallow'>
            <ComponentRef Id='License'/>
            <ComponentRef Id='binary0'/>

            <Feature Id='Environment'
                     Title='PATH Environment Variable'
                     Description='Add the install location of the [ProductName] executable to the PATH system environment variable. This allows the [ProductName] executable to be called from any location.'
                     Level='1'
                     Absent='allow'>
                <ComponentRef Id='Path'/>
            </Feature>

            <Feature Id="DesktopShortcutFeature"
                     Title="Create desktop shortcut"
                     Description="Create a shortcut on the desktop"
                     Level="1">
                <ComponentRef Id="DesktopShortcut"/>
            </Feature>
        </Feature>

        <SetProperty Id='ARPINSTALLLOCATION' Value='[APPLICATIONFOLDER]' After='CostFinalize'/>
        <Property Id='ARPHELPLINK' Value='https://github.com/enzocipher/minimum_path_finder/'/>

        <UI>
            <UIRef Id='WixUI_FeatureTree'/>
        </UI>

        <WixVariable Id='WixUILicenseRtf' Value='wix\License.rtf'/>
    </Product>

    <!-- Fragmento: Acceso directo en escritorio -->
  <Fragment>
      <DirectoryRef Id="DesktopFolder">
          <Component Id="DesktopShortcut" Guid="*">
              <Shortcut Id="ApplicationShortcut"
                        Name="projecto_computacional"
                        Description="Launch projecto_computacional"
                        Target="[APPLICATIONFOLDER]bin\projecto_computacional.exe"
                        Icon="AppIcon.ico"
                        WorkingDirectory="APPLICATIONFOLDER"/>
              <RemoveFolder Id="RemoveDesktopShortcut" On="uninstall"/>
              <RegistryValue Root="HKCU"
                            Key="Software\enzocipher\minimum_path_finder"
                            Name="installed"
                            Type="integer"
                            Value="1"
                            KeyPath="yes"/>
          </Component>
      </DirectoryRef>

      <!-- Ícono del acceso directo (debe ir aquí, fuera del DirectoryRef) -->
      <Icon Id="AppIcon.ico" SourceFile="wix\doron.ico"/>
  </Fragment>
</Wix>
